<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AMC UART reader – WebUSB + Logger</title>
<style>
body {
  background:#2a2a2a;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
  margin:0;
  padding:0;
}
#top {
  padding:15px;
}
button {
  padding:10px 15px;
  font-size:16px;
  background:#5c5c5c;
  color:#fff;
  border:none;
  border-radius:5px;
}
#status {
  margin-top:10px;
}
#logger {
  margin:15px;
  padding:10px;
  background:#111;
  border:1px solid #444;
  border-radius:5px;
  height:40vh;
  overflow-y:auto;
  font-family:monospace;
  font-size:13px;
}
.log-info { color:#9cdcfe; }
.log-ok { color:#4ec9b0; }
.log-warn { color:#dcdcaa; }
.log-err { color:#f44747; }
</style>
</head>
<body>

<div id="top">
  <button id="connectButton">Połącz (WebUSB)</button>
  <div id="status">Status: gotowy</div>
</div>

<div id="logger"></div>

<script src="https://cdn.jsdelivr.net/gh/NielsLeenheer/WebUSBSerial@master/dist/webusb-serial.umd.js"></script>
<script>
const logBox = document.getElementById("logger");
const statusText = document.getElementById("status");
const btn = document.getElementById("connectButton");

function uiLog(msg, cls="log-info") {
  const line = document.createElement("div");
  line.className = cls;
  line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  logBox.appendChild(line);
  logBox.scrollTop = logBox.scrollHeight;
}

uiLog("Start strony");
uiLog("UserAgent: " + navigator.userAgent);
uiLog("isSecureContext=" + window.isSecureContext);
uiLog("navigator.usb=" + ("usb" in navigator));
uiLog("WebUSBSerial=" + (typeof WebUSBSerial !== "undefined"));

btn.addEventListener("click", async () => {
  uiLog("Kliknięto Połącz");
  if (!("usb" in navigator) || typeof WebUSBSerial === "undefined") {
    uiLog("Brak WebUSB / WebUSBSerial w tej przeglądarce", "log-err");
    statusText.textContent = "Status: brak WebUSB";
    return;
  }

  try {
    uiLog("Wywołuję WebUSBSerial.requestPort()");
    const port = await WebUSBSerial.requestPort({
      filters: [{ usbVendorId: 0x0403 }] // FTDI
    });

    uiLog("Wybrano urządzenie USB", "log-ok");
    uiLog(
      `VID=0x${port.device.vendorId.toString(16)} PID=0x${port.device.productId.toString(16)}`
    );

    await port.open({ baudRate: 9600 });
    uiLog("Port otwarty (9600 baud)", "log-ok");
    statusText.textContent = "Status: połączono";

  } catch (e) {
    uiLog("Błąd: " + e.message, "log-err");
    statusText.textContent = "Status: błąd";
  }
});
</script>

</body>
</html>
